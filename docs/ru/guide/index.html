<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Документация | Next2</title><meta name="description" content="Документация по Next2">
    <link rel="modulepreload" href="/php-next2-docs/assets/app.1d07c183.js"><link rel="modulepreload" href="/php-next2-docs/assets/index.html.7eed3310.js"><link rel="modulepreload" href="/php-next2-docs/assets/index.html.1529dd81.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.5d85d43d.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.7b3d5cdd.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.9e73b93a.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.a160e89f.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.d963136f.js"><link rel="prefetch" href="/php-next2-docs/assets/404.html.d494dcc5.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.4b9f7c4b.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.8abdded5.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.5cee30ae.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.96aa28aa.js"><link rel="prefetch" href="/php-next2-docs/assets/index.html.5cd78413.js"><link rel="prefetch" href="/php-next2-docs/assets/404.html.9eed92e6.js"><link rel="prefetch" href="/php-next2-docs/assets/404.2740ef51.js"><link rel="prefetch" href="/php-next2-docs/assets/Layout.e7e83dc0.js">
    <link rel="stylesheet" href="/php-next2-docs/assets/style.2259818a.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/php-next2-docs/" class=""><!----><span class="site-name">Next2</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a aria-current="page" href="/php-next2-docs/ru/guide/" class="router-link-active router-link-exact-active router-link-active" aria-label="Быстрый старт"><!--[--><!--]--> Быстрый старт <!--[--><!--]--></a></div><div class="navbar-item"><a href="/php-next2-docs/ru/api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-item"><a href="/php-next2-docs/ru/examples/" class="" aria-label="Примеры"><!--[--><!--]--> Примеры <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Ссылки"><span class="title">Ссылки</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Ссылки"><span class="title">Ссылки</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/php-next2-docs/ru/extra/" class="" aria-label="Extra"><!--[--><!--]--> Extra <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/php-next2-docs/ru/blog/" class="" aria-label="Блог"><!--[--><!--]--> Блог <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/php-next2-docs/ru/about/" class="" aria-label="О нас"><!--[--><!--]--> О нас <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Языки</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Языки</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/php-next2-docs/ru/guide/" class="router-link-active router-link-exact-active router-link-active" aria-label="Русский"><!--[--><!--]--> Русский <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/php-next2-docs/en/guide/" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/alexpts/php-next2" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a aria-current="page" href="/php-next2-docs/ru/guide/" class="router-link-active router-link-exact-active router-link-active" aria-label="Быстрый старт"><!--[--><!--]--> Быстрый старт <!--[--><!--]--></a></div><div class="navbar-item"><a href="/php-next2-docs/ru/api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-item"><a href="/php-next2-docs/ru/examples/" class="" aria-label="Примеры"><!--[--><!--]--> Примеры <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Ссылки"><span class="title">Ссылки</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Ссылки"><span class="title">Ссылки</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/php-next2-docs/ru/extra/" class="" aria-label="Extra"><!--[--><!--]--> Extra <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/php-next2-docs/ru/blog/" class="" aria-label="Блог"><!--[--><!--]--> Блог <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/php-next2-docs/ru/about/" class="" aria-label="О нас"><!--[--><!--]--> О нас <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Языки</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Языки</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/php-next2-docs/ru/guide/" class="router-link-active router-link-exact-active router-link-active" aria-label="Русский"><!--[--><!--]--> Русский <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/php-next2-docs/en/guide/" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/alexpts/php-next2" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Документация <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/php-next2-docs/ru/guide/#hello-world" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hello World"><!--[--><!--]--> Hello World <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#глоссарии" class="router-link-active router-link-exact-active sidebar-item" aria-label="Глоссарий"><!--[--><!--]--> Глоссарий <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#строительные-блоки" class="router-link-active router-link-exact-active sidebar-item" aria-label="Строительные блоки"><!--[--><!--]--> Строительные блоки <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/php-next2-docs/ru/guide/#handler-обработчик" class="router-link-active router-link-exact-active sidebar-item" aria-label="Handler / Обработчик"><!--[--><!--]--> Handler / Обработчик <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#слои" class="router-link-active router-link-exact-active sidebar-item" aria-label="Слои"><!--[--><!--]--> Слои <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#приложение-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="Приложение"><!--[--><!--]--> Приложение <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#прочее" class="router-link-active router-link-exact-active sidebar-item" aria-label="Прочее"><!--[--><!--]--> Прочее <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/php-next2-docs/ru/guide/#быстрые-http-методы-сахар" class="router-link-active router-link-exact-active sidebar-item" aria-label="Быстрые http методы (сахар)"><!--[--><!--]--> Быстрые http методы (сахар) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#декларативная-кофнигурация" class="router-link-active router-link-exact-active sidebar-item" aria-label="Декларативная кофнигурация"><!--[--><!--]--> Декларативная кофнигурация <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#inline-ограничения-параметров-в-uri" class="router-link-active router-link-exact-active sidebar-item" aria-label="Inline ограничения параметров в uri"><!--[--><!--]--> Inline ограничения параметров в uri <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#flow" class="router-link-active router-link-exact-active sidebar-item" aria-label="Flow"><!--[--><!--]--> Flow <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#psr-15-middleware" class="router-link-active router-link-exact-active sidebar-item" aria-label="PSR-15 Middleware"><!--[--><!--]--> PSR-15 Middleware <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/php-next2-docs/ru/guide/#интеграция" class="router-link-active router-link-exact-active sidebar-item" aria-label="Интеграция"><!--[--><!--]--> Интеграция <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#todo" class="router-link-active router-link-exact-active sidebar-item" aria-label="TODO"><!--[--><!--]--> TODO <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="документация" tabindex="-1"><a class="header-anchor" href="#документация" aria-hidden="true">#</a> Документация</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/php-next2-docs/ru/guide/#hello-world" class="router-link-active router-link-exact-active">Hello World</a></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#глоссарии" class="router-link-active router-link-exact-active">Глоссарий</a></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#строительные-блоки" class="router-link-active router-link-exact-active">Строительные блоки</a><ul><li><a aria-current="page" href="/php-next2-docs/ru/guide/#handler-обработчик" class="router-link-active router-link-exact-active">Handler / Обработчик</a></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#слои" class="router-link-active router-link-exact-active">Слои</a></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#приложение-1" class="router-link-active router-link-exact-active">Приложение</a></li></ul></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#прочее" class="router-link-active router-link-exact-active">Прочее</a><ul><li><a aria-current="page" href="/php-next2-docs/ru/guide/#быстрые-http-методы-сахар" class="router-link-active router-link-exact-active">Быстрые http методы (сахар)</a></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#декларативная-кофнигурация" class="router-link-active router-link-exact-active">Декларативная кофнигурация</a></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#inline-ограничения-параметров-в-uri" class="router-link-active router-link-exact-active">Inline ограничения параметров в uri</a></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#flow" class="router-link-active router-link-exact-active">Flow</a></li></ul></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#psr-15-middleware" class="router-link-active router-link-exact-active">PSR-15 Middleware</a><ul><li><a aria-current="page" href="/php-next2-docs/ru/guide/#интеграция" class="router-link-active router-link-exact-active">Интеграция</a></li></ul></li><li><a aria-current="page" href="/php-next2-docs/ru/guide/#todo" class="router-link-active router-link-exact-active">TODO</a></li></ul></nav><hr><div class="custom-container tip"><p class="custom-container-title">Предыстория</p><p>Next2 является переработкой более ранней библиотеки <a href="https://github.com/alexpts/psr15-next/" target="_blank" rel="noopener noreferrer">psr15-next<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Первая версия была написана для простой, гибкой и быстрой работы с <a href="https://www.php-fig.org/psr/psr-15/" target="_blank" rel="noopener noreferrer">PSR-15 middleware<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> в стиле приложений на фреймворке <a href="https://koajs.com/" target="_blank" rel="noopener noreferrer">KoaJs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, который в свою очередь очень похож на <a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">ExpressJs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div><h2 id="hello-world" tabindex="-1"><a class="header-anchor" href="#hello-world" aria-hidden="true">#</a> Hello World</h2><p>Минимальное приложение с поддержкой PSR-7 на <strong>Next2</strong> выглядит так:</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>Context<span class="token punctuation">\</span>ContextInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>MicroApp</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>Response<span class="token punctuation">\</span>JsonResponse</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>ServerRequest</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>Uri</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span> <span class="token string single-quoted-string">&#39;../../../vendor/autoload.php&#39;</span><span class="token punctuation">;</span>

<span class="token variable">$psr7Request</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerRequest</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;GET&#39;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uri</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$app</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MicroApp</span><span class="token punctuation">;</span>

<span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token property">store</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ContextInterface</span> <span class="token variable">$ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$ctx</span><span class="token operator">-&gt;</span><span class="token function">setResponse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JsonResponse</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;message&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;Hello World!&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$psr7Response</span> <span class="token operator">=</span> <span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$psr7Request</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// psr-15 runner</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="глоссарии" tabindex="-1"><a class="header-anchor" href="#глоссарии" aria-hidden="true">#</a> Глоссарий</h2><h4 id="middleware-обработчик-промежуточного-уровня" tabindex="-1"><a class="header-anchor" href="#middleware-обработчик-промежуточного-уровня" aria-hidden="true">#</a> Middleware (обработчик промежуточного уровня)</h4><p>Middleware - это часть приложения, которая отвечает за конкретную единицу логики в обработке request/response. (<a href="https://www.php-fig.org/psr/psr-15/" target="_blank" rel="noopener noreferrer">PSR-15 middleware<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p><div class="custom-container tip"><p class="custom-container-title">Отсылка к PSR-15</p><p>Первой версия фреймворка использовала <a href="https://www.php-fig.org/psr/psr-15/" target="_blank" rel="noopener noreferrer">PSR-15 middleware<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Next2 используеют похожую на <code>PSR-15</code> по смыслу и сигнатуре модель выстраивания обработчиков.</p><p>Отличия от PSR-15 обработчиков:</p><ul><li>Обработчиком промежуточного уровня выступает любой обработчик с типом <code>callable</code> вместо <code>Psr\Http\Server\MiddlewareInterface</code>.</li><li>Layer может запускать не 1 обработчик, а группу обработчиков <code>callable[]</code>, позволяя делить код на более мелкие части сохраняя логическую целостность.</li></ul></div><h4 id="layer-слои" tabindex="-1"><a class="header-anchor" href="#layer-слои" aria-hidden="true">#</a> Layer / Слой</h4><p>Это абстракция над обработчиком, которая содержит метаинформцию (для простоты это можно считатать алиасом middleware). Layer может иметь как 1 обработчик, так и несколько, чтобы декомпозировать на более мелкие части код. Приложение это набор Layers, которые определяются для каждого http запроса индивидуально.</p><h4 id="приложение" tabindex="-1"><a class="header-anchor" href="#приложение" aria-hidden="true">#</a> Приложение</h4><p>Приложение является самым высоким уровнем и реалзиует полноую обработку запроса. Задача приложения получить на входе http request и создать http response.</p><p>Приложение осознано сводит число сущностей к минимуму, чтобы оставаться действительно простым, понятным и надежным. Основное понятие с которым придется постоянно работать это Layer (Слой).</p><p>Приложеине получает на вход стандартный объект запроса <code>PSR-7</code> и прогоняет через все обработчики слоев. Какие именно слои примут частие в обработке запроса определяется метаифнормацией слоя. Семантически можно выделить следующие типы слоев:</p><ul><li>Активация на любом запросе</li><li>Активация по http методу</li><li>Активация по соответствию uri в регулярном выражении</li></ul><details class="custom-container details"><summary>Собственные стратегии</summary><p>Из коробки идет минимальный набор стратений (по http методу и поиск по uri). Можно дополнительно реализовать любые кастомные правила, по которым будет принято решеине активируетя слой для обработки request или нет. Для э того нужно добавить свою реализацию <code>PTS\Next2\Layer\Resolver\LayerResolverInterface</code></p></details><h2 id="строительные-блоки" tabindex="-1"><a class="header-anchor" href="#строительные-блоки" aria-hidden="true">#</a> Строительные блоки</h2><h3 id="handler-обработчик" tabindex="-1"><a class="header-anchor" href="#handler-обработчик" aria-hidden="true">#</a> Handler / Обработчик</h3><p>Обработчиком может выступать любая форма <code>callable</code> PHP типа. Функция обработчик в общем случае принмает 1 аргумент. Первый аргумент это контекст, который должнен реализовывать <code>PTS\Next2\Context\ContextInterface</code> либо его наследников в случае расширения базового контекста под себя.</p><p>Обработчик это самая минимальная единица.</p><div class="custom-container tip"><p class="custom-container-title">Context</p><p>Контекст - это связующая часть между всеми слоями. Базовый контекст хранит request, response и позволяет получить доступ к текущему слою (Layer) в runtime. В контексте можно хранить все что угодно, расширяя его дочерним классом и не ограничивая себя. Данный подход хорошо себя зарекомендовал в таких фреймворках как <a href="https://koajs.com/" target="_blank" rel="noopener noreferrer">koaJs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> и <a href="https://gofiber.io/" target="_blank" rel="noopener noreferrer">goFiber<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></div><h3 id="слои" tabindex="-1"><a class="header-anchor" href="#слои" aria-hidden="true">#</a> Слои</h3><p>Приложение <code>MicroApp</code> хранит в себе в свойстве <code>$app-&gt;store</code> хранилище слоев <code>LayersStore</code>. Слой инкапсулирует 1 обработчик или группу обработчиков. Хранилище слоев позволяет добавлять обрабочтики к приложению посредством метода <code>use</code>:</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code>    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name">callable<span class="token punctuation">[</span><span class="token punctuation">]</span></span> | callable $handler
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">use</span><span class="token punctuation">(</span><span class="token keyword">callable</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span> <span class="token variable">$handler</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">static</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$layer</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">layerFactory</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token variable">$handler</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">addLayer</span><span class="token punctuation">(</span><span class="token variable">$layer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Чтобы дерелировать управление следующему обработчику, нужно вызвать метод <code>next</code> на объекте контекста:</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">someHandler</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified type-declaration"><span class="token punctuation">\</span>PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>Context<span class="token punctuation">\</span>ContextInterface</span> <span class="token variable">$ctx</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// request phase</span>
        <span class="token variable">$ctx</span><span class="token operator">-&gt;</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// response phase</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">Слоенный подход</p><p>Каждый слой имеет 1 определенную зону отвественности, это позволяет оставаться вашему коду простым и чистым. Слой может самостоятельно создать http response и не передавать управление следующему слою. Например слой, который проверяет аунтификацию, может сам создать http response с статус кодом <code>401</code>. С таким подходом, мы можем очень быстро обрабатывать некоторые запросы, даже не поднимая тяжелый фреймворк, если он используется на последующих слоях.</p><p>Другой пример, это обработчик, который может кешировать запрос и повторно очень быстро отвечать на запрос из кеша.</p></div><h4 id="options" tabindex="-1"><a class="header-anchor" href="#options" aria-hidden="true">#</a> Options</h4><p>Опции объекта Layer</p><table><thead><tr><th>Опция</th><th>Описание</th><th>По умолчанию</th><th>Пример значения</th></tr></thead><tbody><tr><td><strong>path</strong></td><td>описывает uri путь, на который должен активироваться слой, можро использловать регулярки, без указария этого параметра слой активируется на любой uri</td><td>-</td><td><code>/users/{id}</code></td></tr><tr><td><strong>name</strong></td><td>определяем уникальное имя слоя, через это имя можно будет найти слой (по умолчанию все слои получают имена вида <code>l-0</code>, <code>l-1</code> и т.д.)</td><td>-</td><td><code>usersAction</code></td></tr><tr><td><strong>methods</strong></td><td>принимает массив из http методов, слой активируется только на http запросы с указанными http методами. Если методы не переданы, то слой активируется на любой http метод</td><td><code>[]</code></td><td><code>[&#39;GET&#39;]</code></td></tr><tr><td><strong>priority</strong></td><td>принимает <code>int</code> число с приоритетом, чем ни меньше число, тем раньше выполнится слой. Это позволяет конфигурировать слои декларативно, не в порядке добавления</td><td><code>50</code></td><td><code>100</code></td></tr><tr><td><strong>restrictions</strong></td><td>принимает массив вида [&#39;id&#39; =&gt; \id+], позволяя накладывать дополнительные ограничения на переменны в uri запроса</td><td><code>[]</code></td><td><code>[&#39;id&#39;=&gt;&#39;\d+&#39;]</code></td></tr><tr><td><strong>context</strong></td><td>позволяет прикрепить к слою любые произволные данные</td><td><code>[]</code></td><td><code>[&#39;foo&#39;=&gt;&#39;bar&#39;]</code></td></tr></tbody></table><p>Пример использования options в коде:</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>Context<span class="token punctuation">\</span>ContextInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>MicroApp</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>Response<span class="token punctuation">\</span>JsonResponse</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>ServerRequest</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>Uri</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span> <span class="token string single-quoted-string">&#39;../../../vendor/autoload.php&#39;</span><span class="token punctuation">;</span>

<span class="token variable">$psr7Request</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerRequest</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;GET&#39;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uri</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/hello/alex/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$app</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MicroApp</span><span class="token punctuation">;</span>

<span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token property">store</span><span class="token operator">-&gt;</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ContextInterface</span> <span class="token variable">$ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$ctx</span><span class="token operator">-&gt;</span><span class="token function">getUriParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token variable">$ctx</span><span class="token operator">-&gt;</span><span class="token property">response</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonResponse</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;message&#39;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Hello <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span></span>!&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;path&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/hello/{name}/&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;helloWorldAction&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;priority&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">50</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;methods&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;GET|HEAD&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;restrictions&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;[a-zA-Z0-9]+&#39;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$psr7Response</span> <span class="token operator">=</span> <span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$psr7Request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="приложение-1" tabindex="-1"><a class="header-anchor" href="#приложение-1" aria-hidden="true">#</a> Приложение</h3><p>Приложение это самый высокий слой. Приложение инкапсулирует группу слоев. Приложения могут объединяться через <code>CompositionMicroApp</code> в общее приложение.</p><h2 id="прочее" tabindex="-1"><a class="header-anchor" href="#прочее" aria-hidden="true">#</a> Прочее</h2><h3 id="быстрые-http-методы-сахар" tabindex="-1"><a class="header-anchor" href="#быстрые-http-методы-сахар" aria-hidden="true">#</a> Быстрые http методы (сахар)</h3><p>Для упрощения также доступны методы, которые зеркалируют основные http методы, например:</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token property">store</span>
    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/users/{id}/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token variable">$ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token variable">$ctx</span><span class="token operator">-&gt;</span><span class="token property">response</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonResponse</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/users/{id}/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token variable">$ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/users/{id}/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token variable">$ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/users/{id}/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token variable">$ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/users/{id}/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">fn</span><span class="token punctuation">(</span><span class="token variable">$ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">Быстрые методы</p><p>Полный список методов можно найти в трейте <code>PTS\Next2\Layer\Store\FastMethodsTrait</code>. Он реализует самые популярные методы. Вы можете добавить свои методы для сахара</p></div><h3 id="декларативная-кофнигурация" tabindex="-1"><a class="header-anchor" href="#декларативная-кофнигурация" aria-hidden="true">#</a> Декларативная кофнигурация</h3><p>Очень удобно конфигурировать маршруты и порядок декларативно, например посредством yml файлов, простой пример такой конфигурации выглядит так:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># middlewares</span>
<span class="token key atrule">ThrowableToResponse</span><span class="token punctuation">:</span>
  <span class="token key atrule">controller</span><span class="token punctuation">:</span> Site\Middleware\ThrowableToResponse<span class="token punctuation">:</span>process

<span class="token comment"># 404 page</span>
<span class="token key atrule">otherwise</span><span class="token punctuation">:</span>
  <span class="token key atrule">handler</span><span class="token punctuation">:</span> Site\Controller\Action\Page404<span class="token punctuation">:</span>__invoke
  <span class="token key atrule">name</span><span class="token punctuation">:</span> otherwise
  <span class="token key atrule">priority</span><span class="token punctuation">:</span> <span class="token number">10000</span>

<span class="token comment"># actions</span>
<span class="token key atrule">main</span><span class="token punctuation">:</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /
  <span class="token key atrule">methods</span><span class="token punctuation">:</span> <span class="token string">&#39;GET|HEAD&#39;</span>
  <span class="token key atrule">handler</span><span class="token punctuation">:</span> Site\Controller\OtherwiseController<span class="token punctuation">:</span>mainPage

<span class="token key atrule">posts</span><span class="token punctuation">:</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /post/
  <span class="token key atrule">methods</span><span class="token punctuation">:</span> <span class="token string">&#39;GET&#39;</span>
  <span class="token key atrule">handler</span><span class="token punctuation">:</span> Site\Controller\PostController<span class="token punctuation">:</span>getList

<span class="token key atrule">cat</span><span class="token punctuation">:</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /cat/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>/
  <span class="token key atrule">restrictions</span><span class="token punctuation">:</span>
    <span class="token key atrule">id</span><span class="token punctuation">:</span> \d+
  <span class="token key atrule">methods</span><span class="token punctuation">:</span> <span class="token string">&#39;GET&#39;</span>
  <span class="token key atrule">handler</span><span class="token punctuation">:</span> Site\Controller\CategoryController<span class="token punctuation">:</span>getCat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Можно расширять декларативную конфигурацию посредством расширения класса <code>PTS\Next2\LayerLayerFactory</code> или реалзиации <code>PTS\Next2\LayerFactoryInterface</code> интерфейса.</p><h3 id="inline-ограничения-параметров-в-uri" tabindex="-1"><a class="header-anchor" href="#inline-ограничения-параметров-в-uri" aria-hidden="true">#</a> Inline ограничения параметров в uri</h3><p>Ограничения на параметр в <code>path</code> можно описать дополнительно прямо в <code>path</code> помимо конфигурации опции <code>restrictions</code> у слоя. Inline формат записи проще для простых регулярок. Для сложных и длинных регулярок лучше использовать явно опцию <code>restrictions</code>, чтобы конфигурация слоя оставалась простой для чтения и интерпритации. В общем виде такая форма записи выглядит так <code>{name:restrictRegExp}</code>. Следующие конфигурации будут эквивалентны:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">cat</span><span class="token punctuation">:</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /cat/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>/
  <span class="token key atrule">restrictions</span><span class="token punctuation">:</span>
    <span class="token key atrule">id</span><span class="token punctuation">:</span> \d+

<span class="token key atrule">cat2</span><span class="token punctuation">:</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /cat/<span class="token punctuation">{</span>id<span class="token punctuation">:</span>\d+<span class="token punctuation">}</span>/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">Приоритет</p><p>Inline ограничения будут проигнорированы, если для параметра по имени параметра сконфигурировано в конфиге слоя ограничение</p></div><h3 id="flow" tabindex="-1"><a class="header-anchor" href="#flow" aria-hidden="true">#</a> Flow</h3><p>Каждый слой может что-то делать до вызова <code>$ctx-&gt;next()</code> на этапе запроса, также может что-то делать после вызова <code>$ctx-&gt;next()</code> на этапе ответа. Пример полного выполнения запроса, который проходит сквозь все слои:</p><p><img src="/php-next2-docs/img/layers/200.png?style=centerme" alt="200 flow"></p><p>Пример flow, кога запрос досрочно может быть обработан одним из слоев, без делегирования обработки через <code>$ctx-&gt;next()</code>:</p><p><img src="/php-next2-docs/img/layers/401.png?style=centerme" alt="401 flow"></p><p>Каждый слой решает сам, создать http response и пректатить обработку, либо вызвать следующий слой и делегировать ему тем самым обработку.</p><h2 id="psr-15-middleware" tabindex="-1"><a class="header-anchor" href="#psr-15-middleware" aria-hidden="true">#</a> PSR-15 Middleware</h2><h3 id="интеграция" tabindex="-1"><a class="header-anchor" href="#интеграция" aria-hidden="true">#</a> Интеграция</h3><p>Приложение реализует интерфейс <code>Psr\Http\Server\RequestHandlerInterface</code> из <code>PSR-15</code>. За счет этого оно может интегрировться в любые приложения как middleware, принимая на вход <code>PSR7 Request</code> и возвращая <code>PSR7 Response</code>.</p><p>Схематично это выглядит как <code>psr15</code> -&gt; <code>psr15</code> -&gt; <code>next2</code>.</p><hr><p>Если микро приложение должно делегировать обработку запроса далее в классическую <code>PSR-15 Middleware</code>, то можно обернуть в такую middleware:</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code>
<span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Message<span class="token punctuation">\</span>ResponseInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Message<span class="token punctuation">\</span>ServerRequestInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Server<span class="token punctuation">\</span>MiddlewareInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Server<span class="token punctuation">\</span>RequestHandlerInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>Adapter<span class="token punctuation">\</span>Psr7RunnerAdapter</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>Context<span class="token punctuation">\</span>ContextInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>Layer<span class="token punctuation">\</span>Layer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PTS<span class="token punctuation">\</span>Next2<span class="token punctuation">\</span>MicroApp</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">NextMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">MiddlewareInterface</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name">Layer<span class="token punctuation">[</span><span class="token punctuation">]</span></span> */</span>
    <span class="token keyword">protected</span> <span class="token keyword type-declaration">array</span> <span class="token variable">$layers</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name type-declaration">Psr7RunnerAdapter</span> <span class="token variable">$runner</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">MicroApp</span> <span class="token variable">$app</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">layers</span> <span class="token operator">=</span> <span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token property">store</span><span class="token operator">-&gt;</span><span class="token function">getLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">runner</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Psr7RunnerAdapter</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">process</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ServerRequestInterface</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">RequestHandlerInterface</span> <span class="token variable">$handler</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">ResponseInterface</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$callable</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ContextInterface</span> <span class="token variable">$ctx</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$handler</span><span class="token operator">-&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$ctx</span><span class="token operator">-&gt;</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$ctx</span><span class="token operator">-&gt;</span><span class="token function">setResponse</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token variable">$adapterLayer</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$callable</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$layers</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">layers</span><span class="token punctuation">,</span> <span class="token variable">$adapterLayer</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">runner</span><span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token variable">$layers</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token variable">$handler</span><span class="token operator">-&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Схематично это выглядит как <code>psr15</code> -&gt; <code>psr15</code> -&gt; <code>next2</code> -&gt; <code>psr15</code>.</p><p>Такие интеграции позволяют точечно заменять части старого приложения или переносить небольшими кусочками часть функционала.</p><h2 id="todo" tabindex="-1"><a class="header-anchor" href="#todo" aria-hidden="true">#</a> TODO</h2><ul><li>подумать о передачи в <code>$ctx-&gt;next()</code> аргументов, которые придут экстра аргументами в следующий handler помимо контекста.</li><li>подумать об ограничении uri параметров до регулядки [A-Za-z0-9_-]) по дефолту</li><li>подумать о автозаполнителях и валидаторах параметров из запроса как в koaJs router <a href="https://github.com/ZijianHe/koa-router#module_koa-router--Router+param" target="_blank" rel="noopener noreferrer">param<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (сейчас легко реализуются обработчиком или слоем с сохранением в конеткст, без ввода новой абстракции или сахара)</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/alexpts/php-next2-docs//edit/master/src/ru/guide/index.md" rel="noopener noreferrer" target="_blank" aria-label="Редактировать"><!--[--><!--]--> Редактировать <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Обновлено: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Авторы: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: alexpts@yandex.ru">alexpts</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/php-next2-docs/assets/app.1d07c183.js" defer></script>
  </body>
</html>
